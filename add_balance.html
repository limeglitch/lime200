<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ’° Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­Ø§Ù…ÙŠ</title>
  <!-- Ø¥Ø¶Ø§ÙØ© Firebase SDK Ø§Ù„Ù†Ø³Ø®Ø© 8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <style>
    body {
      background-color: #121212;
      color: white;
      font-family: Arial;
      text-align: center;
      padding: 30px;
    }
    input, button {
      margin: 10px;
      padding: 10px;
      font-size: 16px;
    }
    .actions {
      margin-top: 20px;
    }
    .balances {
      margin-top: 40px;
      border-top: 1px solid #555;
      padding-top: 20px;
      text-align: right;
      direction: rtl;
    }
  </style>
</head>
<body>
  <h2>ğŸ’° Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø­Ø§Ù…ÙŠ</h2>

  <input type="text" id="lawyer-username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø§Ù„Ù…Ø­Ø§Ù…ÙŠ)">
  <input type="number" id="amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¬Ù†ÙŠÙ‡">

  <div class="actions">
    <button onclick="addBalance()">â• Ø¥Ø¶Ø§ÙØ©</button>
    <button onclick="deductBalance()">â– Ø®ØµÙ…</button>
    <button onclick="resetBalance()">ğŸ§¹ ØªØµÙÙŠØ± Ø±ØµÙŠØ¯</button>
    <button onclick="showAllBalances()">ğŸ“‹ Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø£Ø±ØµØ¯Ø©</button>
  </div>

  <div class="balances" id="balances-list">
    <!-- Ù‡Ù†Ø§ Ù‡ØªØ¸Ù‡Ø± ÙƒÙ„ Ø§Ù„Ø£Ø±ØµØ¯Ø© -->
  </div>

  <script>
    // Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyDikvQqTbn8x2Yd2FiyzrMOVO7dO-r-3og",
        authDomain: "lime-4c195.firebaseapp.com",
        projectId: "lime-4c195",
        storageBucket: "lime-4c195.appspot.com",
        messagingSenderId: "253428642396",
        appId: "1:253428642396:web:e0136755418eaf6534ac99",
        measurementId: "G-VV32PRPQGX"
    };

    // ØªÙ‡ÙŠØ¦Ø© Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    function getBalanceRef(username) {
        return db.collection("balances").doc(username);
    }

    function getUserRole(userId) {
        return db.collection("users").doc(userId).get();
    }

    function addBalance() {
        const username = document.getElementById("lawyer-username").value.trim();
        const amount = parseFloat(document.getElementById("amount").value);

        if (!username || isNaN(amount) || amount <= 0) {
            alert("âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… ÙˆÙ…Ø¨Ù„Øº ØµØ­ÙŠØ­.");
            return;
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø£Ø¯Ù…Ù† Ø£Ùˆ Ù…Ø­Ø§Ù…ÙŠ)
        auth.onAuthStateChanged(function(user) {
            if (user) {
                getUserRole(user.uid).then(function(doc) {
                    const role = doc.data().role;
                    if (role !== "admin") {
                        alert("âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ§Øª Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©.");
                        return;
                    }

                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø£Ø¯Ù…Ù†ØŒ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ØµÙŠØ¯
                    const balanceRef = getBalanceRef(username);
                    balanceRef.get().then(function(doc) {
                        let currentBalance = doc.exists ? doc.data().balance : 0;
                        let updatedBalance = currentBalance + amount;

                        balanceRef.set({ balance: updatedBalance }).then(function() {
                            alert(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© ${amount} Ø¬Ù†ÙŠÙ‡ Ø¥Ù„Ù‰ ${username}.`);
                            showAllBalances();
                        }).catch(function(error) {
                            alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ØµÙŠØ¯.");
                            console.error(error);
                        });
                    });
                });
            }
        });
    }

    function deductBalance() {
        const username = document.getElementById("lawyer-username").value.trim();
        const amount = parseFloat(document.getElementById("amount").value);

        if (!username || isNaN(amount) || amount <= 0) {
            alert("âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… ÙˆÙ…Ø¨Ù„Øº ØµØ­ÙŠØ­.");
            return;
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø£Ø¯Ù…Ù† Ø£Ùˆ Ù…Ø­Ø§Ù…ÙŠ)
        auth.onAuthStateChanged(function(user) {
            if (user) {
                getUserRole(user.uid).then(function(doc) {
                    const role = doc.data().role;
                    if (role !== "admin") {
                        alert("âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ§Øª Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©.");
                        return;
                    }

                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø£Ø¯Ù…Ù†ØŒ Ø®ØµÙ… Ø§Ù„Ø±ØµÙŠØ¯
                    const balanceRef = getBalanceRef(username);
                    balanceRef.get().then(function(doc) {
                        if (!doc.exists) {
                            alert("âŒ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.");
                            return;
                        }

                        let currentBalance = doc.data().balance;
                        if (currentBalance < amount) {
                            alert(`âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø®ØµÙ… ${amount} Ø¬Ù†ÙŠÙ‡ Ù„Ø£Ù† Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­ Ù‡Ùˆ ${currentBalance} Ø¬Ù†ÙŠÙ‡.`);
                            return;
                        }

                        let updatedBalance = currentBalance - amount;
                        balanceRef.set({ balance: updatedBalance }).then(function() {
                            alert(`âœ… ØªÙ… Ø®ØµÙ… ${amount} Ø¬Ù†ÙŠÙ‡ Ù…Ù† ${username}.`);
                            showAllBalances();
                        }).catch(function(error) {
                            alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø®ØµÙ… Ø§Ù„Ø±ØµÙŠØ¯.");
                            console.error(error);
                        });
                    });
                });
            }
        });
    }

    function resetBalance() {
        const username = document.getElementById("lawyer-username").value.trim();

        if (!username) {
            alert("âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….");
            return;
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø£Ø¯Ù…Ù† Ø£Ùˆ Ù…Ø­Ø§Ù…ÙŠ)
        auth.onAuthStateChanged(function(user) {
            if (user) {
                getUserRole(user.uid).then(function(doc) {
                    const role = doc.data().role;
                    if (role !== "admin") {
                        alert("âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ§Øª Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©.");
                        return;
                    }

                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø£Ø¯Ù…Ù†ØŒ ØªØµÙÙŠØ± Ø§Ù„Ø±ØµÙŠØ¯
                    const balanceRef = getBalanceRef(username);
                    balanceRef.set({ balance: 0 }).then(function() {
                        alert(`ğŸ§¹ ØªÙ… ØªØµÙÙŠØ± Ø±ØµÙŠØ¯ ${username}.`);
                        showAllBalances();
                    }).catch(function(error) {
                        alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØµÙÙŠØ± Ø§Ù„Ø±ØµÙŠØ¯.");
                        console.error(error);
                    });
                });
            }
        });
    }

    function showAllBalances() {
        const balancesDiv = document.getElementById("balances-list");
        balancesDiv.innerHTML = "";

        db.collection("balances").get().then(function(querySnapshot) {
            if (querySnapshot.empty) {
                balancesDiv.innerHTML = "<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø±ØµØ¯Ø© Ù…Ø³Ø¬Ù„Ø© Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</p>";
            } else {
                querySnapshot.forEach(function(doc) {
                    const username = doc.id;
                    const balance = doc.data().balance;
                    balancesDiv.innerHTML += `<p>ğŸ‘¤ <strong>${username}</strong> â€” ğŸ’° Ø§Ù„Ø±ØµÙŠØ¯: ${balance} Ø¬Ù†ÙŠÙ‡</p>`;
                });
            }
        }).catch(function(error) {
            alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±ØµØ¯Ø©.");
            console.error(error);
        });
    }

    window.onload = showAllBalances;
  </script>
</body>
</html>
